<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Product Bill</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Toastr CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />

  <style>
    body {
      background-color: #f5f7fa;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .bill-container {
      max-width: 900px;
      margin: 40px auto;
      background: #fff;
      padding: 2.5rem 3rem;
      border-radius: 0.5rem;
      box-shadow: 0 0 18px rgba(0,0,0,0.1);
    }
    h2 {
      color: #2c3e50;
    }
    .table thead {
      background-color: #34495e;
      color: white;
    }
    .table tbody tr:nth-child(even) {
      background-color: #ecf0f1;
    }
    .total-row {
      font-weight: 700;
      font-size: 1.2rem;
      background-color: #bdc3c7;
    }
    .btn-primary {
      background-color: #2980b9;
      border-color: #2980b9;
    }
    .btn-primary:hover {
      background-color: #2471a3;
      border-color: #2471a3;
    }
  </style>
</head>
<body>

  <div class="bill-container">
    <h2 class="mb-4">Product Bill</h2>

    <form id="billForm">
      <div class="row mb-4">
        <div class="col-md-6">
          <label for="billNumber" class="form-label">Bill Number *</label>
          <input type="text" class="form-control" id="billNumber" placeholder="BILL-001" required />
        </div>
        <div class="col-md-6">
          <label for="billDate" class="form-label">Date *</label>
          <input type="date" class="form-control" id="billDate" required />
        </div>
      </div>

      <div class="row mb-4">
        <div class="col-md-6">
          <label for="customerName" class="form-label">Customer Name *</label>
          <input type="text" class="form-control" id="customerName" placeholder="Customer Name" required />
        </div>
        <div class="col-md-6">
          <label for="customerEmail" class="form-label">Email</label>
          <input type="email" class="form-control" id="customerEmail" placeholder="email@example.com" />
        </div>
      </div>

      <h5>Products</h5>
      <table class="table table-bordered align-middle" id="productsTable">
        <thead>
          <tr>
            <th style="width: 35%;">Product Name *</th>
            <th style="width: 15%;">Quantity *</th>
            <th style="width: 15%;">Unit Price ($) *</th>
            <th style="width: 15%;">Discount (%)</th>
            <th style="width: 15%;">Amount ($)</th>
            <th style="width: 5%;">Actions</th>
          </tr>
        </thead>
        <tbody>
          <!-- Product rows -->
        </tbody>
        <tfoot>
          <tr>
            <td colspan="4" class="text-end fw-bold">Subtotal:</td>
            <td id="subtotalAmount">$0.00</td>
            <td></td>
          </tr>
          <tr>
            <td colspan="4" class="text-end fw-bold">Tax (10%):</td>
            <td id="taxAmount">$0.00</td>
            <td></td>
          </tr>
          <tr class="total-row">
            <td colspan="4" class="text-end fw-bold">Total:</td>
            <td id="totalAmount">$0.00</td>
            <td></td>
          </tr>
        </tfoot>
      </table>

      <button type="button" class="btn btn-secondary mb-3" id="addProductBtn">+ Add Product</button>
      <br />
      <button type="submit" class="btn btn-primary">Generate Bill</button>
    </form>
  </div>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Toastr JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

  <script>
    $(document).ready(function () {
      // Add product row
      function addProductRow() {
        const rowHtml = `
          <tr>
            <td><input type="text" class="form-control product-name" placeholder="Product Name" required></td>
            <td><input type="number" min="1" step="1" class="form-control product-qty" value="1" required></td>
            <td><input type="number" min="0" step="0.01" class="form-control product-price" value="0.00" required></td>
            <td><input type="number" min="0" max="100" step="0.01" class="form-control product-discount" value="0"></td>
            <td class="product-amount">$0.00</td>
            <td><button type="button" class="btn btn-danger btn-sm remove-product">Remove</button></td>
          </tr>
        `;
        $('#productsTable tbody').append(rowHtml);
      }

      // Initialize with one product row
      addProductRow();

      // Add product button click
      $('#addProductBtn').click(function () {
        addProductRow();
      });

      // Remove product row
      $('#productsTable').on('click', '.remove-product', function () {
        $(this).closest('tr').remove();
        recalcTotals();
      });

      // Recalculate totals on input change
      $('#productsTable').on('input', '.product-qty, .product-price, .product-discount', function () {
        recalcTotals();
      });

      function recalcTotals() {
        let subtotal = 0;
        $('#productsTable tbody tr').each(function () {
          const qty = parseFloat($(this).find('.product-qty').val()) || 0;
          const price = parseFloat($(this).find('.product-price').val()) || 0;
          const discount = parseFloat($(this).find('.product-discount').val()) || 0;

          let amount = qty * price;
          if (discount > 0) {
            amount -= amount * (discount / 100);
          }
          $(this).find('.product-amount').text(`$${amount.toFixed(2)}`);
          subtotal += amount;
        });

        const tax = subtotal * 0.10; // 10% tax
        const total = subtotal + tax;

        $('#subtotalAmount').text(`$${subtotal.toFixed(2)}`);
        $('#taxAmount').text(`$${tax.toFixed(2)}`);
        $('#totalAmount').text(`$${total.toFixed(2)}`);
      }

      // Form submit
      $('#billForm').submit(function (e) {
        e.preventDefault();

        const billNumber = $('#billNumber').val().trim();
        const billDate = $('#billDate').val();
        const customerName = $('#customerName').val().trim();

        if (!billNumber || !billDate || !customerName) {
          toastr.error('Please fill all required fields.');
          return;
        }

        let valid = true;
        $('#productsTable tbody tr').each(function () {
          const name = $(this).find('.product-name').val().trim();
          const qty = parseInt($(this).find('.product-qty').val());
          const price = parseFloat($(this).find('.product-price').val());

          if (!name || isNaN(qty) || qty <= 0 || isNaN(price) || price < 0) {
            valid = false;
            return false;
          }
        });

        if (!valid || $('#productsTable tbody tr').length === 0) {
          toastr.error('Please add valid products.');
          return;
        }

        toastr.success(`Bill #${billNumber} generated successfully!`);

        // Reset form
        this.reset();
        $('#productsTable tbody').empty();
        addProductRow();
        recalcTotals();
      });
    });
  </script>
</body>
</html>
