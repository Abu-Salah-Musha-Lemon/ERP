<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cash Memo</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Toastr CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />

  <style>
    body {
      background-color: #f9fafb;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .memo-container {
      max-width: 900px;
      margin: 40px auto;
      background: white;
      padding: 2rem 3rem;
      border-radius: 0.5rem;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    .table thead {
      background-color: #343a40;
      color: white;
    }
    .table tbody tr:nth-child(even) {
      background-color: #f8f9fa;
    }
    .total-row {
      font-weight: 700;
      font-size: 1.2rem;
    }
    .btn-primary {
      background-color: #0d3b66;
      border-color: #0d3b66;
    }
    .btn-primary:hover {
      background-color: #095288;
      border-color: #095288;
    }
  </style>
</head>
<body>
  <div class="memo-container">
    <h2 class="mb-4">Cash Memo</h2>

    <form id="cashMemoForm">
      <div class="row mb-4">
        <div class="col-md-6">
          <label for="memoNumber" class="form-label">Memo Number *</label>
          <input type="text" class="form-control" id="memoNumber" placeholder="CM-001" required />
        </div>
        <div class="col-md-6">
          <label for="memoDate" class="form-label">Date *</label>
          <input type="date" class="form-control" id="memoDate" required />
        </div>
      </div>

      <div class="row mb-4">
        <div class="col-md-6">
          <label for="customerName" class="form-label">Customer Name *</label>
          <input type="text" class="form-control" id="customerName" placeholder="John Doe" required />
        </div>
        <div class="col-md-6">
          <label for="customerContact" class="form-label">Contact Number</label>
          <input type="tel" class="form-control" id="customerContact" placeholder="+1234567890" />
        </div>
      </div>

      <h5>Items Sold</h5>
      <table class="table table-bordered align-middle" id="itemsTable">
        <thead>
          <tr>
            <th style="width: 35%;">Product Name *</th>
            <th style="width: 15%;">Quantity *</th>
            <th style="width: 20%;">Unit Price ($) *</th>
            <th style="width: 20%;">Amount</th>
            <th style="width: 10%;">Actions</th>
          </tr>
        </thead>
        <tbody>
          <!-- Items will be added here -->
        </tbody>
        <tfoot>
          <tr>
            <td colspan="3" class="text-end fw-bold">Total:</td>
            <td id="totalAmount">$0.00</td>
            <td></td>
          </tr>
        </tfoot>
      </table>

      <button type="button" class="btn btn-secondary mb-3" id="addItemBtn">+ Add Item</button>
      <br />
      <button type="submit" class="btn btn-primary">Save Cash Memo</button>
    </form>
  </div>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Toastr JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

  <script>
    $(document).ready(function () {
      function recalcTotal() {
        let total = 0;
        $('#itemsTable tbody tr').each(function () {
          const qty = parseFloat($(this).find('.item-qty').val()) || 0;
          const price = parseFloat($(this).find('.item-price').val()) || 0;
          const amount = qty * price;
          $(this).find('.item-amount').text(`$${amount.toFixed(2)}`);
          total += amount;
        });
        $('#totalAmount').text(`$${total.toFixed(2)}`);
      }

      // Add a new empty item row
      function addItemRow() {
        const rowHtml = `
          <tr>
            <td><input type="text" class="form-control item-name" placeholder="Product Name" required></td>
            <td><input type="number" min="1" step="1" class="form-control item-qty" value="1" required></td>
            <td><input type="number" min="0" step="0.01" class="form-control item-price" value="0.00" required></td>
            <td class="item-amount">$0.00</td>
            <td><button type="button" class="btn btn-danger btn-sm remove-item">Remove</button></td>
          </tr>
        `;
        $('#itemsTable tbody').append(rowHtml);
      }

      // Initialize with one item row
      addItemRow();

      // Add item button
      $('#addItemBtn').click(function () {
        addItemRow();
      });

      // Remove item button (event delegation)
      $('#itemsTable').on('click', '.remove-item', function () {
        $(this).closest('tr').remove();
        recalcTotal();
      });

      // Recalculate total on quantity or price change
      $('#itemsTable').on('input', '.item-qty, .item-price', function () {
        recalcTotal();
      });

      // Handle form submit
      $('#cashMemoForm').submit(function (e) {
        e.preventDefault();

        // Basic validation: memo number, date, customer name, at least 1 item
        const memoNumber = $('#memoNumber').val().trim();
        const memoDate = $('#memoDate').val();
        const customerName = $('#customerName').val().trim();
        const items = [];

        if (!memoNumber || !memoDate || !customerName) {
          toastr.error('Please fill all required fields.');
          return;
        }

        let validItems = true;
        $('#itemsTable tbody tr').each(function () {
          const name = $(this).find('.item-name').val().trim();
          const qty = parseInt($(this).find('.item-qty').val());
          const price = parseFloat($(this).find('.item-price').val());

          if (!name || isNaN(qty) || qty <= 0 || isNaN(price) || price < 0) {
            validItems = false;
            return false; // break
          }
          items.push({ name, qty, price });
        });

        if (!validItems || items.length === 0) {
          toastr.error('Please provide valid items.');
          return;
        }

        // If valid, just show success message (in real app, save data)
        toastr.success(`Cash Memo #${memoNumber} saved successfully!`);

        // Reset form & table
        this.reset();
        $('#itemsTable tbody').empty();
        addItemRow();
        recalcTotal();
      });
    });
  </script>
</body>
</html>
